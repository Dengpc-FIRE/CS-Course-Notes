# 数据链路层概述

## 数据链路层在网络体系中的地位

**数据链路**：是指把实现通信协议的硬件和软件加到链路上，构成了数据链路

**数据链路层以帧为单位传输和处理数据**

![image-20221122214056387](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221122214056387.png)

## 使用点对点信道的数据链路层

三个重要问题：封装成帧，差错检错，可靠传输

**封装成帧**：数据链路层给网络层协议数据单元添加一个数据链路层协议首部，简称为帧头，还要添加一个帧尾。

封装成帧目的就是为了以帧为数据单元传输数据，实现数据链路层本身的功能

![image-20221122221533205](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221122221533205.png)

**差错检测**：封装在帧尾（FCS字段），接收方根据检测码和检测算法判断

**可靠传输**：如果数据链路层向上层提供的是不可靠服务，那么丢弃就丢弃了，不会有更多措施。如果数据链路层向上提供的是可靠服务，那么需要其他措施，使接收方重新收到被丢弃的这个帧的正确副本

![image-20221122222153353](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221122222153353.png)

## 使用广播信道的数据链路层

1.共享式以太网的媒体介入控制接入协议CSMA/CD

2.802.11局域网的媒体接入控制协议CSMA/CA

## 数据链路层的互联设备

1.网桥和交换机的工作原理

2.集线器（物理层互联设备）与交换机的区别



# 封装成帧

> **数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧**

**帧头和帧尾包含重要的控制信息**

**帧头和帧尾的作用之一就是帧定界**

物理层将帧中的各比特转换成电信号发送到传输媒体

> 接受方如何从物理层交付的比特流中提取出帧呢？

帧头和帧尾的作用之一就是帧定界，但不是每一种数据链路层协议的帧都包含帧定界标志，如以太网版本2的MAC帧格式，他是通过物理层在帧前面加8字节的前导码，然后再发送。前导码中前七个为前同步码，一字节为帧开始定界符。并且以太网还定义了帧间间隔。



区分他是帧定界符还是数据----字节--转义字符 ，比特--零比特填充法  ![image-20221122224917177](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221122224917177.png)

![image-20221122225302155](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221122225302155.png)

# 差错检测

![image-20221122235456627](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221122235456627.png)

## 奇偶校验

**在待发送的数据后面添加1位奇偶校验位，使整个数据（包括添加的校验位在内）为奇数（奇校验）或偶数（偶校验）**

![image-20221123000645899](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123000645899.png)

## 循环冗余校验CRC

![image-20221123000853517](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123000853517.png)

![image-20221123001156779](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123001156779.png)

![image-20221123001518699](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123001518699.png)

# 可靠传输

![image-20221123082119822](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123082119822.png)

一般情况下，有线链路的误码率比较低，为了减小开销，不要求数据链路层向上提供可靠传输服务，即使出现了误码，可靠传输问题由其上层解决。

无线传输易受干扰，误码率比较高，因此数据链路层必须向上层提供可靠传输服务。

![image-20221123081854731](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123081854731.png)

## 停止等待协议SW

![image-20221123083255994](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123083255994.png)

**信道利用率**

![image-20221123083726798](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123083726798.png)

## 回退N帧协议GBN

![image-20221123090112956](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123090112956.png)

![image-20221123090217194](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123090217194.png)

回退N帧协议在流水线基础上利用发送窗口限制发送方连续发送数据分组的数量，是一种连续ARQ协议

这类协议又称滑动窗口协议

## 选择重传协议

**回退N帧协议**的接受窗口尺寸**WR只能等于1**，因此接收方只能**按序**接受正确到达的数据分组

一个数据分组的误码会导致其后连续多个数据分组不能被接收方接受而丢弃（尽管他们无乱序和误码），这必然会造成发送方对这些数据分组的超时重传，这是对通信资源的极大浪费

为进一步提高性能，可设法只重传出现误码的数据分组，因此，接收方窗口WR应该大于1，以便**接收方先收下失序到达但无误码并且序号落在接受窗口内的那些数据分组**，等到所缺分组收齐后再一并送交上层，这就是**选择重传协议**。

> 选择重传协议为了使发送方仅重传出现差错的分组，**接收方不在采用累计确认**，而需对每个正确收到数据分组进行逐一确认。

![image-20221123092419695](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123092419695.png)

![img](https://img2022.cnblogs.com/blog/3006655/202211/3006655-20221123103057520-1444649690.png)

![image-20221123103400641](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123103400641.png)

# 点对点协议PPP

### 概述

**点对点协议PPP是目前使用最广泛地点对点数据链路层协议**

PPP协议为在点对点链路传输各种协议数据报提供了一个标准方法

1. 对各种协议数据包的封装方法(封装成帧)
2. 链路控制协议LCP  用于建立、配置以及测试数据链路层的链接
3. 一套网络控制协议NCPs  其中每一个协议支持不同的网络协议

![image-20221123104058817](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123104058817.png)

### 帧格式

![image-20221123104334942](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123104334942.png)

### 透明传输

![image-20221123105640617](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123105640617.png)

![image-20221123105827935](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123105827935.png)

### 差错检测

**接收方每收到一个PPP帧，就进行CPC检验。若CRC检验正确，就收下这个帧；反之，就丢弃这个帧。使用PPP的数据链路层向上不提供可靠传输服务**

### PPP协议工作状态

![image-20221123110458900](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123110458900.png)

# 媒体介入控制

## 基本概念

> 共享信道要着重考虑的一个问题就是如何协调多个发送和接受站点对一个共享媒体的占用，即**媒体接入控制MAC**

![image-20221123163637252](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123163637252.png)

## 静态划分信道

信道复用，**复用**：通过一条物理线路同时传输多路用户的信号。

当网络中的传输媒体的传输容量大于多条单一信道传输的总通信量时，可利用复用技术在一条物理线路上建立多条通信信道来充分利用传输媒体的带宽

![image-20221123164301312](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123164301312.png)

常见信道复用技术：频分复用FDM，时分复用TDM，波分复用WDM，码分复用CDM

**频分复用**

![image-20221123164509483](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123164509483.png)

**时分复用**

![image-20221123164622628](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123164622628.png)

**波分复用**

![image-20221123164828056](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123164828056.png)

**码分复用**

![image-20221123170011891](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123170011891.png)

![image-20221123170116769](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123170116769.png)

![image-20221123170150533](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123170150533.png)

![image-20221123170227114](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123170227114.png)

## 动态接入控制----随机接入----CSMA/CD协议

![image-20221123170722237](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123170722237.png)

![image-20221123171211075](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123171211075.png)

![image-20221123171509928](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123171509928.png)

![image-20221123171647163](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123171647163.png)

![image-20221123172144503](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123172144503.png)

![image-20221123172404335](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123172404335.png)

![image-20221123172603059](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123172603059.png)

![image-20221123172837398](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123172837398.png)

![image-20221123174629279](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123174629279.png)

**CSMA/CD应用于广播信道的有线局域网**

**CSMA/CA 应用于刚播信道的局域网**

![image-20221123174844357](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123174844357.png)

# MAC地址、IP地址、ARP协议

**MAC地址**是以太网的MAC子层所使用的地址

**IP地址**是TCP/IP体系结构网际层所使用的地址

**ARP协议**属于TCP/IP体系结构的网际层，其作用是已知设备所分配到的IP地址，使用ARP协议可以通过该IP地址获取到设备的MAC地址

## MAC地址

![image-20221123180639349](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123180639349.png)

![image-20221123181244081](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123181244081.png)

![image-20221123181157816](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123181157816.png)

**字节发送顺序：第一字节到第六字节**

**字节内比特发送顺序：b0到b7**

**单播MAC地址**

![image-20221123181655801](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123181655801.png)

**广播MAC地址**

![image-20221123181933709](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123181933709.png)

**多播MAC地址**

![image-20221123182150491](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123182150491.png)

## IP地址

> **IP地址是因特网上主机和路由器所使用的地址**

标识两部分

1. 网络编号：标识因特网上数以百计的网络
2. 主机编号：标识同一网络上不同主机

![image-20221123183245178](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123183245178.png)

![image-20221123183444196](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123183444196.png)

![image-20221123183714909](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123183714909.png)

## ARP协议

![image-20221123184043598](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123184043598.png)

![image-20221123184322726](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123184322726.png)

![image-20221123184357095](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123184357095.png)

**ARP协议只能在一段链路或者一个网络上使用**

![image-20221123184538491](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123184538491.png)



# 集线器与交换机区别

![image-20221123185431373](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123185431373.png)

**集线器**

![image-20221123185508244](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123185508244.png)

![image-20221123185724150](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123185724150.png)

**交换机**

![image-20221123202159517](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123202159517.png)

**对比**

![image-20221123202728823](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123202728823.png)

![image-20221123202936564](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123202936564.png)

![image-20221123203024051](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123203024051.png)

# 以太网交换机自学习和转发帧的流程

> 以太网交换机工作在数据链路层
>
> 以太网交换机收到帧以后，在**帧交换表中查找帧的目的MAC地址所对应的接口号**，然后通过该接口转发帧
>
> 以太网交换机是一种即插即用设备，刚启动时其内部的帧交换表是空的，随着网络中各主机通信，**以太网交换机通过自学习算法自动逐渐建立起帧交换表**

**自学习**

![image-20221123204249311](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123204249311.png)

![image-20221123204531331](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123204531331.png)

![image-20221123204741799](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123204741799.png)

# 以太网交换机生成树协议STP

![image-20221123205203304](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123205203304.png)

![image-20221123205546420](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123205546420.png)

# 虚拟局域网VLAN

## 概述

> 使用一个或多个以太网交换机互联起来的交换式以太网，起所有站点都属于同一个广播域
>
> 巨大广播域带来很多弊端
>
> 广播风暴，难以管理维护，潜在安全问题

![image-20221123210026190](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123210026190.png)

**分割广播域的方法**

1. 使用路由器可以隔离广播域
2. 虚拟局域网技术

虚拟局域网VLAN是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同需求

![image-20221123210509008](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123210509008.png)

## VLAN实现机制

**IEEE 802.1Q帧**

![image-20221123211005722](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123211005722.png)

**交换机的端口类型**

三种类型：Access，Trunk，Hybrid

**Access**

![image-20221123211436817](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123211436817.png)

**Trunk**

![image-20221123220847192](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123220847192.png)

![image-20221123221751325](C:\Users\邓\AppData\Roaming\Typora\typora-user-images\image-20221123221751325.png)